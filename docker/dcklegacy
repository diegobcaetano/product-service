# Use a imagem oficial do Go como imagem base
FROM golang:latest as builder

# Defina o diretório de trabalho dentro do container
WORKDIR /app

# Copie o módulo go e as dependências
COPY go.mod ./
COPY go.sum* ./
RUN if [ -f go.sum ]; then go mod download; fi

# Copie o código fonte para o diretório de trabalho
COPY . .

# Compile o aplicativo Go para um binário
RUN CGO_ENABLED=0 GOOS=linux go build -o product-service ./cmd/api

# Use uma imagem Docker scratch para uma imagem leve e segura
FROM scratch

# Copie o binário para a imagem scratch
COPY --from=builder /app/product-service ../.

# Porta que seu serviço irá rodar
EXPOSE 8080

# Execute o binário
CMD ["./product-service"]